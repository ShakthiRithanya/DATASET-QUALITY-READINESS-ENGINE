class PipelineGenerator:
    """
    Generates ready-to-use scikit-learn pipeline code based on cleaning decisions.
    """
    def __init__(self, audit_log: list):
        self.audit_log = audit_log

    def generate_code(self) -> str:
        code_lines = [
            "import pandas as pd",
            "from sklearn.pipeline import Pipeline",
            "from sklearn.impute import SimpleImputer",
            "from sklearn.preprocessing import StandardScaler",
            "from sklearn.compose import ColumnTransformer",
            "",
            "# Auto-generated by DQRE v1.0",
            "def get_preprocessing_pipeline():",
            "    numeric_features = []",
            "    categorical_features = []"
        ]
        
        # Simple extraction from audit log
        for log in self.audit_log:
            if "impute" in log["action"]:
                if "mode" in log["action"]:
                    code_lines.append(f"    categorical_features.append('{log['column']}')")
                else:
                    code_lines.append(f"    numeric_features.append('{log['column']}')")

        code_lines.extend([
            "",
            "    preprocessor = ColumnTransformer(",
            "        transformers=[",
            "            ('num', SimpleImputer(strategy='median'), numeric_features),",
            "            ('cat', SimpleImputer(strategy='most_frequent'), categorical_features),",
            "        ])",
            "",
            "    return Pipeline(steps=[",
            "        ('preprocessor', preprocessor),",
            "        ('scaler', StandardScaler())",
            "    ])",
            "",
            "# Usage:",
            "# pipeline = get_preprocessing_pipeline()",
            "# X_cleaned = pipeline.fit_transform(X)"
        ])
        
        return "\n".join(code_lines)
